<!DOCTYPE html>
<html class="light" lang="de">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>Lux Start Page</title>
        <!-- Google Fonts: Bricolage Grotesque and Libertinus Serif -->
        <link
            href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200;12..96,300;12..96,400;12..96,500;12..96,600;12..96,700&family=Libertinus+Serif:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

        <!-- Theme Configuration -->
        <script id="tailwind-config">
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            primary: '#ec4d13',
                            'background-light':
                                '#f2f0e3' /* Beige wie gew√ºnscht */,
                            'background-dark':
                                '#1a1614' /* Sehr dunkles warmes Grau f√ºr Darkmode */,
                        },
                        fontFamily: {
                            display: ['Bricolage Grotesque', 'sans-serif'],
                            script: ['Libertinus Serif', 'serif'],
                        },
                        borderRadius: {
                            DEFAULT: '0.25rem',
                            lg: '0.5rem',
                            xl: '0.75rem',
                            '2xl': '1rem',
                            full: '9999px',
                        },
                        animation: {
                            'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        },
                        keyframes: {
                            fadeInUp: {
                                '0%': {
                                    opacity: '0',
                                    transform: 'translateY(20px)',
                                },
                                '100%': {
                                    opacity: '1',
                                    transform: 'translateY(0)',
                                },
                            },
                        },
                    },
                },
            };
        </script>

        <style>
            /* Custom Noise Background */
            .bg-noise {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 0;
                opacity: 0.05;
                background-image: repeating-linear-gradient(
                        0deg,
                        transparent,
                        transparent 2px,
                        rgba(0, 0, 0, 0.03) 2px,
                        rgba(0, 0, 0, 0.03) 4px
                    ),
                    repeating-linear-gradient(
                        90deg,
                        transparent,
                        transparent 2px,
                        rgba(0, 0, 0, 0.03) 2px,
                        rgba(0, 0, 0, 0.03) 4px
                    );
            }

            /* Glassmorphism Utilities */
            .glass-panel {
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
            }

            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0,
                    'opsz' 24;
            }

            /* Delete Button styling */
            .delete-btn {
                opacity: 0;
                transition: all 0.2s ease;
            }
            .group:hover .delete-btn {
                opacity: 1;
            }

            /* Autocomplete Dropdown */
            #autocomplete-list {
                max-height: 30vh;
                overflow-y: auto;
                scrollbar-width: thin;
                scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
            }
            #autocomplete-list::-webkit-scrollbar {
                width: 6px;
            }
            #autocomplete-list::-webkit-scrollbar-thumb {
                background-color: rgba(0, 0, 0, 0.2);
                border-radius: 3px;
            }
            .dark #autocomplete-list::-webkit-scrollbar-thumb {
                background-color: rgba(255, 255, 255, 0.2);
            }

            /* Greeting emphasis */
            #greeting em {
                font-style: italic;
                font-family: 'Libertinus Serif', serif;
                color: #ec4d13;
            }

            /* Drag and Drop */
            .dragging {
                opacity: 0.5;
                transform: scale(0.95);
            }
            .drag-over {
                transform: scale(1.05);
                border-color: #ec4d13 !important;
            }

            /* Select dropdown options styling */
            select option {
                background-color: white;
                color: #1e293b;
            }
            .dark select option {
                background-color: #1a1614;
                color: #f1f5f9;
            }
        </style>
    </head>
    <body
        class="font-display bg-background-light dark:bg-background-dark min-h-screen flex flex-col items-center justify-center text-slate-800 dark:text-slate-100 selection:bg-primary/30 relative overflow-hidden transition-colors duration-500"
    >
        <!-- Weather Widget (Top Left) -->
        <div
            id="weather-widget"
            onclick="openWeatherModal()"
            class="absolute top-6 left-6 z-50 flex items-center gap-2 px-3 py-2 rounded-full bg-white/20 dark:bg-white/5 backdrop-blur-sm border border-white/30 dark:border-white/10 text-slate-700 dark:text-slate-300 transition-colors cursor-pointer hover:bg-white/30 dark:hover:bg-white/10"
        >
            <span id="weather-icon" class="text-2xl">üå§Ô∏è</span>
            <span id="weather-temp" class="text-sm font-medium">--¬∞</span>
        </div>

        <!-- Settings and Theme Toggle Buttons (Top Right) -->
        <div class="absolute top-6 right-6 z-50 flex gap-2">
            <!-- Settings Button -->
            <button
                onclick="openSettingsModal()"
                class="w-12 h-12 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-slate-600 dark:text-slate-300 transition-colors"
            >
                <span class="material-symbols-outlined">settings</span>
            </button>

            <!-- Theme Toggle Button -->
            <button
                onclick="toggleTheme()"
                class="w-12 h-12 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-slate-600 dark:text-slate-300 transition-colors"
            >
                <span id="theme-icon" class="material-symbols-outlined"
                    >dark_mode</span
                >
            </button>
        </div>

        <!-- Noise Texture Overlay -->
        <div class="bg-noise mix-blend-overlay dark:opacity-[0.15]"></div>

        <!-- Soft Gradient Background Blob (Orange only) -->
        <div
            class="absolute top-[-20%] left-[-10%] w-[70vw] h-[70vw] bg-primary/10 rounded-full blur-[120px] pointer-events-none mix-blend-multiply dark:mix-blend-screen dark:bg-primary/5"
        ></div>
        <!-- Blue blob removed as requested -->

        <!-- Main Layout Container -->
        <main
            class="layout-container relative z-10 w-full max-w-5xl px-6 py-10 flex flex-col items-center gap-10"
        >
            <!-- Greeting Section -->
            <header class="text-center animate-fade-in-up">
                <h1
                    id="greeting"
                    class="font-script text-5xl md:text-6xl lg:text-7xl tracking-tight drop-shadow-sm select-none"
                >
                    <!-- Greeting will be set by JavaScript -->
                </h1>
            </header>

            <!-- Search Bar Section -->
            <div
                class="flex flex-col items-center w-full max-w-[720px] animate-fade-in-up z-10 gap-5"
                style="animation-delay: 0.1s"
            >
                <div class="relative group/search w-full">
                    <form
                        id="search-form"
                        action="https://www.google.com/search"
                        method="GET"
                        class="glass-panel relative flex items-center w-full h-16 rounded-xl border border-black/5 dark:border-white/10 bg-white/40 dark:bg-black/20 shadow-lg shadow-black/5 hover:shadow-xl hover:bg-white/60 dark:hover:bg-black/30 transition-all duration-300 ring-4 ring-transparent focus-within:ring-primary/20"
                    >
                        <!-- Search Icon -->
                        <div
                            class="pl-6 pr-3 flex items-center justify-center text-slate-500 dark:text-slate-400 group-focus-within/search:text-primary transition-colors"
                        >
                            <span class="material-symbols-outlined text-[28px]"
                                >search</span
                            >
                        </div>
                        <!-- Input -->
                        <input
                            id="search-input"
                            name="q"
                            autocomplete="off"
                            class="w-full h-full bg-transparent border-none text-xl text-slate-800 dark:text-slate-100 placeholder:text-slate-500/60 dark:placeholder:text-slate-500 focus:ring-0 focus:outline-none font-display tracking-wide"
                            placeholder=""
                            type="text"
                            autofocus
                        />
                        <!-- Action Icons -->
                        <div class="pr-6 pl-3 flex items-center gap-2">
                            <button
                                type="button"
                                onclick="clearSearch()"
                                id="clear-btn"
                                class="hidden p-2 rounded-full flex items-center justify-center hover:bg-slate-200/50 dark:hover:bg-white/10 text-slate-400 dark:text-slate-500 hover:text-primary dark:hover:text-primary transition-colors"
                            >
                                <span
                                    class="material-symbols-outlined text-[20px]"
                                    >close</span
                                >
                            </button>
                            <button
                                type="submit"
                                class="p-2 rounded-full flex items-center justify-center hover:bg-slate-200/50 dark:hover:bg-white/10 text-slate-400 dark:text-slate-500 hover:text-primary dark:hover:text-primary transition-colors"
                                aria-label="Senden"
                            >
                                <span
                                    class="material-symbols-outlined text-[20px]"
                                    >send</span
                                >
                            </button>
                        </div>
                    </form>

                    <!-- Autocomplete Dropdown -->
                    <div
                        id="autocomplete-container"
                        class="hidden absolute top-full left-0 right-0 mt-2 glass-panel bg-white/95 dark:bg-black/90 border border-black/5 dark:border-white/10 rounded-xl shadow-2xl overflow-hidden z-[100]"
                    >
                        <div id="autocomplete-list" class="py-2">
                            <!-- Suggestions will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shortcuts Dock -->
            <div
                id="shortcuts-container"
                class="flex flex-wrap justify-center gap-4 md:gap-6 mt-2 animate-fade-in-up"
                style="animation-delay: 0.2s"
            >
                <!-- Shortcuts werden hier per JS eingef√ºgt -->
            </div>
        </main>

        <!-- Modal f√ºr neue Verkn√ºpfung -->
        <div
            id="add-modal"
            class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm transition-all duration-300"
        >
            <div
                class="glass-panel bg-[#f2f0e3]/95 dark:bg-[#1a1614]/95 p-8 rounded-2xl w-full max-w-sm border border-black/10 dark:border-white/10 shadow-2xl transform scale-100"
            >
                <h3
                    id="modal-title"
                    class="text-2xl font-script mb-6 text-center"
                >
                    <!-- Title set by JS -->
                </h3>

                <div class="space-y-4">
                    <input
                        type="text"
                        id="shortcut-name"
                        class="w-full bg-black/5 dark:bg-white/5 border border-black/10 dark:border-white/10 rounded-xl px-4 py-3 text-slate-800 dark:text-slate-100 placeholder-slate-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                        placeholder=""
                    />
                    <input
                        type="text"
                        id="shortcut-url"
                        class="w-full bg-black/5 dark:bg-white/5 border border-black/10 dark:border-white/10 rounded-xl px-4 py-3 text-slate-800 dark:text-slate-100 placeholder-slate-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                        placeholder=""
                    />
                </div>

                <div class="flex gap-3 mt-8">
                    <button
                        id="modal-cancel"
                        onclick="closeModal()"
                        class="flex-1 py-2 rounded-xl text-slate-500 hover:bg-black/5 dark:hover:bg-white/5 hover:text-slate-800 dark:hover:text-slate-200 transition-colors"
                    >
                        <!-- Text set by JS -->
                    </button>
                    <button
                        id="modal-save"
                        onclick="addShortcut()"
                        class="flex-1 py-2 rounded-xl bg-primary text-white font-medium hover:bg-orange-600 shadow-lg shadow-orange-900/20 transition-all"
                    >
                        <!-- Text set by JS -->
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div
            id="settings-modal"
            class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm transition-all duration-300"
        >
            <div
                class="glass-panel bg-[#f2f0e3]/95 dark:bg-[#1a1614]/95 p-8 rounded-2xl w-full max-w-2xl max-h-[85vh] overflow-y-auto border border-black/10 dark:border-white/10 shadow-2xl transform scale-100"
            >
                <!-- Close Button -->
                <button
                    onclick="closeSettingsModal()"
                    class="absolute top-4 right-4 p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors"
                >
                    <span class="material-symbols-outlined text-slate-500"
                        >close</span
                    >
                </button>

                <!-- Settings Title -->
                <h3
                    id="settings-title"
                    class="text-3xl font-script text-center text-slate-800 dark:text-slate-200 mb-8"
                >
                    <!-- Title set by JS -->
                </h3>

                <!-- Settings Content -->
                <div class="space-y-6">
                    <!-- Theme Setting -->
                    <div
                        class="flex items-center justify-between p-4 rounded-lg bg-white/40 dark:bg-white/5"
                    >
                        <div>
                            <h4
                                id="settings-theme-title"
                                class="text-lg font-medium text-slate-800 dark:text-slate-200"
                            >
                                <!-- Text set by JS -->
                            </h4>
                            <p
                                id="settings-theme-desc"
                                class="text-sm text-slate-600 dark:text-slate-400"
                            >
                                <!-- Text set by JS -->
                            </p>
                        </div>
                        <button
                            onclick="toggleTheme()"
                            class="w-12 h-12 flex items-center justify-center rounded-full bg-white/60 dark:bg-white/10 hover:bg-black/5 dark:hover:bg-white/15 text-slate-600 dark:text-slate-300 transition-colors"
                        >
                            <span class="material-symbols-outlined"
                                >dark_mode</span
                            >
                        </button>
                    </div>

                    <!-- Language Setting -->
                    <div
                        class="flex items-center justify-between p-4 rounded-lg bg-white/40 dark:bg-white/5"
                    >
                        <div class="flex-1">
                            <h4
                                id="settings-language-title"
                                class="text-lg font-medium text-slate-800 dark:text-slate-200"
                            >
                                <!-- Text set by JS -->
                            </h4>
                            <p
                                id="settings-language-desc"
                                class="text-sm text-slate-600 dark:text-slate-400"
                            >
                                <!-- Text set by JS -->
                            </p>
                        </div>
                        <select
                            id="language-selector"
                            onchange="changeLanguage(this.value)"
                            class="pl-4 pr-10 py-2 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors cursor-pointer"
                        >
                            <option value="de">Deutsch</option>
                            <option value="en">English</option>
                            <option value="es">Espa√±ol</option>
                            <!-- Add more languages here -->
                        </select>
                    </div>

                    <!-- Name Setting -->
                    <div
                        class="flex items-center justify-between p-4 rounded-lg bg-white/40 dark:bg-white/5"
                    >
                        <div class="flex-1 mr-4">
                            <h4
                                id="settings-name-title"
                                class="text-lg font-medium text-slate-800 dark:text-slate-200"
                            >
                                <!-- Text set by JS -->
                            </h4>
                            <p
                                id="settings-name-desc"
                                class="text-sm text-slate-600 dark:text-slate-400"
                            >
                                <!-- Text set by JS -->
                            </p>
                        </div>
                        <input
                            type="text"
                            id="user-name-input"
                            onchange="updateUserName()"
                            onblur="updateUserName()"
                            class="px-4 py-2 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors w-48"
                            placeholder=""
                        />
                    </div>

                    <!-- Time Format Setting -->
                    <div
                        class="flex items-center justify-between p-4 rounded-lg bg-white/40 dark:bg-white/5"
                    >
                        <div class="flex-1">
                            <h4
                                id="settings-timeformat-title"
                                class="text-lg font-medium text-slate-800 dark:text-slate-200"
                            >
                                <!-- Text set by JS -->
                            </h4>
                            <p
                                id="settings-timeformat-desc"
                                class="text-sm text-slate-600 dark:text-slate-400"
                            >
                                <!-- Text set by JS -->
                            </p>
                        </div>
                        <select
                            id="timeformat-selector"
                            onchange="changeTimeFormat(this.value)"
                            class="pl-4 pr-10 py-2 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors cursor-pointer"
                        >
                            <option value="24" id="timeformat-24h-option">
                                <!-- Text set by JS -->
                            </option>
                            <option value="12" id="timeformat-12h-option">
                                <!-- Text set by JS -->
                            </option>
                        </select>
                    </div>

                    <!-- Reset Button -->
                    <div
                        class="flex items-center justify-center p-4 rounded-lg bg-red-50/40 dark:bg-red-900/10 border border-red-200/50 dark:border-red-800/30 mt-4"
                    >
                        <button
                            id="reset-settings-btn"
                            onclick="resetToDefaults()"
                            class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 font-medium transition-colors"
                        >
                            <span class="material-symbols-outlined text-[20px]"
                                >restart_alt</span
                            >
                            <span id="reset-settings-text"
                                ><!-- Text set by JS --></span
                            >
                        </button>
                    </div>

                    <!-- Credits -->
                    <div
                        class="flex items-center justify-center p-4 rounded-lg bg-white/40 dark:bg-white/5 mt-4"
                    >
                        <p class="text-sm text-slate-600 dark:text-slate-400">
                            Made with <span class="text-primary">‚ô•</span> by
                            <a
                                href="https://github.com/trpwrmusic"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="text-primary hover:underline font-medium transition-colors"
                            >
                                @trpwrmusic
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Modal -->
        <div
            id="onboarding-modal"
            class="fixed inset-0 bg-black/60 hidden items-center justify-center z-[60] backdrop-blur-sm transition-all duration-300"
        >
            <div
                class="glass-panel bg-[#f2f0e3]/95 dark:bg-[#1a1614]/95 p-8 rounded-2xl w-full max-w-2xl border border-black/10 dark:border-white/10 shadow-2xl transform scale-100"
            >
                <!-- Step 1: Welcome & Features -->
                <div id="onboarding-step-1" class="onboarding-step">
                    <!-- Welcome Icon -->
                    <div class="text-center mb-6">
                        <span class="text-6xl">üëã</span>
                    </div>

                    <!-- Title -->
                    <h3
                        id="onboarding-title"
                        class="text-4xl font-script text-center text-slate-800 dark:text-slate-200 mb-4"
                    >
                        <!-- Title set by JS -->
                    </h3>

                    <!-- Subtitle -->
                    <p
                        id="onboarding-subtitle"
                        class="text-center text-slate-600 dark:text-slate-400 mb-8"
                    >
                        <!-- Subtitle set by JS -->
                    </p>

                    <!-- Features Grid (3 Features ohne Search) -->
                    <div class="grid grid-cols-3 gap-4 mb-8">
                        <!-- Feature 1: Shortcuts -->
                        <div
                            class="flex flex-col items-center gap-3 p-4 rounded-lg bg-white/40 dark:bg-white/5"
                        >
                            <span
                                class="material-symbols-outlined text-primary text-3xl"
                                >link</span
                            >
                            <div class="text-center">
                                <h4
                                    id="onboarding-feature1-title"
                                    class="font-medium text-slate-800 dark:text-slate-200 mb-1 text-sm"
                                >
                                    <!-- Text set by JS -->
                                </h4>
                                <p
                                    id="onboarding-feature1-desc"
                                    class="text-xs text-slate-600 dark:text-slate-400"
                                >
                                    <!-- Text set by JS -->
                                </p>
                            </div>
                        </div>

                        <!-- Feature 2: Weather -->
                        <div
                            class="flex flex-col items-center gap-3 p-4 rounded-lg bg-white/40 dark:bg-white/5"
                        >
                            <span
                                class="material-symbols-outlined text-primary text-3xl"
                                >partly_cloudy_day</span
                            >
                            <div class="text-center">
                                <h4
                                    id="onboarding-feature2-title"
                                    class="font-medium text-slate-800 dark:text-slate-200 mb-1 text-sm"
                                >
                                    <!-- Text set by JS -->
                                </h4>
                                <p
                                    id="onboarding-feature2-desc"
                                    class="text-xs text-slate-600 dark:text-slate-400"
                                >
                                    <!-- Text set by JS -->
                                </p>
                            </div>
                        </div>

                        <!-- Feature 3: Personalization -->
                        <div
                            class="flex flex-col items-center gap-3 p-4 rounded-lg bg-white/40 dark:bg-white/5"
                        >
                            <span
                                class="material-symbols-outlined text-primary text-3xl"
                                >settings</span
                            >
                            <div class="text-center">
                                <h4
                                    id="onboarding-feature3-title"
                                    class="font-medium text-slate-800 dark:text-slate-200 mb-1 text-sm"
                                >
                                    <!-- Text set by JS -->
                                </h4>
                                <p
                                    id="onboarding-feature3-desc"
                                    class="text-xs text-slate-600 dark:text-slate-400"
                                >
                                    <!-- Text set by JS -->
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Next Button -->
                    <button
                        id="onboarding-next-btn"
                        onclick="nextOnboardingStep()"
                        class="w-full py-3 rounded-xl bg-primary text-white font-medium hover:bg-orange-600 shadow-lg shadow-orange-900/20 transition-all text-lg"
                    >
                        <!-- Text set by JS -->
                    </button>

                    <!-- Language Selector -->
                    <div class="flex justify-end mt-4">
                        <select
                            id="onboarding-language-selector"
                            onchange="changeLanguage(this.value)"
                            class="pl-3 pr-8 py-2 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors cursor-pointer text-sm"
                        >
                            <option value="de">üá©üá™ DE</option>
                            <option value="en">üá¨üáß EN</option>
                            <option value="es">üá™üá∏ ES</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Settings -->
                <div id="onboarding-step-2" class="onboarding-step hidden">
                    <!-- Settings Icon -->
                    <div class="text-center mb-6">
                        <span class="text-6xl">‚öôÔ∏è</span>
                    </div>

                    <!-- Title -->
                    <h3
                        id="onboarding-settings-title"
                        class="text-3xl font-script text-center text-slate-800 dark:text-slate-200 mb-4"
                    >
                        <!-- Title set by JS -->
                    </h3>

                    <!-- Subtitle -->
                    <p
                        id="onboarding-settings-subtitle"
                        class="text-center text-slate-600 dark:text-slate-400 mb-8"
                    >
                        <!-- Subtitle set by JS -->
                    </p>

                    <!-- Settings Form -->
                    <div class="space-y-6 mb-8">
                        <!-- Name Input -->
                        <div class="p-4 rounded-lg bg-white/40 dark:bg-white/5">
                            <label
                                for="onboarding-name-input"
                                class="block mb-2"
                            >
                                <h4
                                    id="onboarding-name-label"
                                    class="text-lg font-medium text-slate-800 dark:text-slate-200 mb-1"
                                >
                                    <!-- Text set by JS -->
                                </h4>
                                <p
                                    id="onboarding-name-desc"
                                    class="text-sm text-slate-600 dark:text-slate-400"
                                >
                                    <!-- Text set by JS -->
                                </p>
                            </label>
                            <input
                                type="text"
                                id="onboarding-name-input"
                                class="w-full px-4 py-3 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors"
                                placeholder=""
                            />
                        </div>

                        <!-- Time Format -->
                        <div class="p-4 rounded-lg bg-white/40 dark:bg-white/5">
                            <label
                                for="onboarding-timeformat-selector"
                                class="block mb-2"
                            >
                                <h4
                                    id="onboarding-timeformat-label"
                                    class="text-lg font-medium text-slate-800 dark:text-slate-200 mb-1"
                                >
                                    <!-- Text set by JS -->
                                </h4>
                                <p
                                    id="onboarding-timeformat-desc"
                                    class="text-sm text-slate-600 dark:text-slate-400"
                                >
                                    <!-- Text set by JS -->
                                </p>
                            </label>
                            <select
                                id="onboarding-timeformat-selector"
                                class="w-full pl-4 pr-10 py-3 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors cursor-pointer"
                            >
                                <option
                                    value="24"
                                    id="onboarding-timeformat-24h"
                                >
                                    24h
                                </option>
                                <option
                                    value="12"
                                    id="onboarding-timeformat-12h"
                                >
                                    12h
                                </option>
                            </select>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex gap-3">
                        <button
                            id="onboarding-back-btn"
                            onclick="previousOnboardingStep()"
                            class="flex-1 py-3 rounded-xl text-slate-500 hover:bg-black/5 dark:hover:bg-white/5 hover:text-slate-800 dark:hover:text-slate-200 transition-colors font-medium"
                        >
                            <!-- Text set by JS -->
                        </button>
                        <button
                            id="onboarding-finish-btn"
                            onclick="finishOnboarding()"
                            class="flex-1 py-3 rounded-xl bg-primary text-white font-medium hover:bg-orange-600 shadow-lg shadow-orange-900/20 transition-all text-lg"
                        >
                            <!-- Text set by JS -->
                        </button>
                    </div>

                    <!-- Language Selector -->
                    <div class="flex justify-end mt-4">
                        <select
                            id="onboarding-language-selector-step2"
                            onchange="changeLanguage(this.value)"
                            class="pl-3 pr-8 py-2 rounded-lg bg-white/60 dark:bg-white/10 border border-black/10 dark:border-white/10 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-colors cursor-pointer text-sm"
                        >
                            <option value="de">üá©üá™ DE</option>
                            <option value="en">üá¨üáß EN</option>
                            <option value="es">üá™üá∏ ES</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Modal -->
        <div
            id="weather-modal"
            class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm transition-all duration-300"
        >
            <div
                class="glass-panel bg-[#f2f0e3]/95 dark:bg-[#1a1614]/95 p-8 rounded-2xl w-full max-w-4xl max-h-[85vh] overflow-y-auto border border-black/10 dark:border-white/10 shadow-2xl transform scale-100"
            >
                <!-- Close Button -->
                <button
                    onclick="closeWeatherModal()"
                    class="absolute top-4 right-4 p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors"
                >
                    <span class="material-symbols-outlined text-slate-500"
                        >close</span
                    >
                </button>

                <!-- Location -->
                <h3
                    id="weather-location"
                    class="text-2xl text-center text-slate-800 dark:text-slate-200 mb-6"
                >
                    Hannover, Germany
                </h3>

                <!-- Two Column Layout -->
                <div class="flex gap-8 items-center">
                    <!-- Left Column (2/3) - Current + Hourly -->
                    <div class="flex-[2]">
                        <!-- Current Weather -->
                        <div class="text-center mb-8">
                            <div
                                class="flex items-center justify-center gap-2 mb-2"
                            >
                                <span
                                    id="weather-current-temp"
                                    class="text-8xl font-light"
                                    >12</span
                                >
                                <div class="flex flex-col items-start">
                                    <span class="text-3xl">¬∞</span>
                                    <span
                                        id="weather-current-icon"
                                        class="text-3xl"
                                        >üå§Ô∏è</span
                                    >
                                </div>
                            </div>
                            <div
                                class="flex items-center justify-center gap-4 text-sm text-slate-600 dark:text-slate-400"
                            >
                                <span
                                    >H: <span id="weather-high">14</span>¬∞</span
                                >
                                <span>L: <span id="weather-low">8</span>¬∞</span>
                            </div>
                        </div>

                        <!-- Hourly Forecast -->
                        <div>
                            <div
                                id="hourly-forecast"
                                class="flex gap-4 overflow-x-auto pb-2 justify-center"
                            >
                                <!-- Hourly items will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div
                        class="w-px bg-slate-300 dark:bg-slate-700 self-stretch"
                    ></div>

                    <!-- Right Column (1/3) - 7-Day Forecast -->
                    <div class="flex-1">
                        <div id="daily-forecast" class="space-y-3">
                            <!-- Daily items will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // --- LANGUAGE MANAGEMENT ---
            const translations = {
                de: {
                    // Greetings
                    greeting_morning: 'guten <em>morgen</em>',
                    greeting_afternoon: 'guten <em>tag</em>',
                    greeting_evening: 'guten <em>abend</em>',
                    greeting_night: 'gute <em>nacht</em>',

                    // Search
                    search_placeholder: 'Suchbegriff oder URL eingeben',
                    search_aria_label: 'Senden',

                    // Modal - Add Shortcut
                    modal_title: 'Neuer Shortcut',
                    modal_name_placeholder: 'Name (z.B. Reddit)',
                    modal_url_placeholder: 'URL (z.B. reddit.com)',
                    modal_cancel: 'Abbrechen',
                    modal_save: 'Speichern',

                    // Settings Modal
                    settings_title: 'Einstellungen',
                    settings_theme: 'Design',
                    settings_theme_desc:
                        'Zwischen hellem und dunklem Modus wechseln',
                    settings_language: 'Sprache',
                    settings_language_desc: 'W√§hle deine bevorzugte Sprache',
                    settings_name: 'Name',
                    settings_name_desc: 'Personalisiere deine Begr√º√üung',
                    settings_name_placeholder: 'Dein Name',
                    settings_timeformat: 'Zeitformat',
                    settings_timeformat_desc:
                        'W√§hle zwischen 12h und 24h Format',
                    timeformat_12h: '12 Stunden',
                    timeformat_24h: '24 Stunden',
                    reset_settings: 'Zur√ºcksetzen',

                    // Onboarding
                    onboarding_title: 'willkommen bei lux',
                    onboarding_subtitle:
                        'Deine personalisierte Startseite f√ºr produktives Arbeiten',
                    onboarding_feature1_title: 'Shortcuts',
                    onboarding_feature1_desc:
                        'Lieblingsseiten immer griffbereit',
                    onboarding_feature2_title: 'Wetter',
                    onboarding_feature2_desc: 'Live-Wetter und Vorhersage',
                    onboarding_feature3_title: 'Personalisierung',
                    onboarding_feature3_desc: 'Theme und Sprache anpassen',
                    onboarding_next_btn: 'Weiter ‚Üí',
                    onboarding_settings_title: 'Einstellungen',
                    onboarding_settings_subtitle:
                        'Passe Lux an deine Bed√ºrfnisse an',
                    onboarding_name_label: 'Dein Name',
                    onboarding_name_desc: 'Wie sollen wir dich begr√º√üen?',
                    onboarding_name_placeholder: 'z.B. Max',
                    onboarding_timeformat_label: 'Zeitformat',
                    onboarding_timeformat_desc: 'W√§hle dein bevorzugtes Format',
                    onboarding_back_btn: '‚Üê Zur√ºck',
                    onboarding_finish_btn: "Los geht's! üöÄ",

                    // Weather
                    weather_location_default: 'Dein Standort',
                    weather_now: 'Jetzt',
                    weather_today: 'Heute',
                    weather_days_short: [
                        'So',
                        'Mo',
                        'Di',
                        'Mi',
                        'Do',
                        'Fr',
                        'Sa',
                    ],
                },
                en: {
                    // Greetings
                    greeting_morning: 'good <em>morning</em>',
                    greeting_afternoon: 'good <em>afternoon</em>',
                    greeting_evening: 'good <em>evening</em>',
                    greeting_night: 'good <em>night</em>',

                    // Search
                    search_placeholder: 'Enter search term or URL',
                    search_aria_label: 'Submit',

                    // Modal - Add Shortcut
                    modal_title: 'New Shortcut',
                    modal_name_placeholder: 'Name (e.g. Reddit)',
                    modal_url_placeholder: 'URL (e.g. reddit.com)',
                    modal_cancel: 'Cancel',
                    modal_save: 'Save',

                    // Settings Modal
                    settings_title: 'Settings',
                    settings_theme: 'Theme',
                    settings_theme_desc: 'Toggle between light and dark mode',
                    settings_language: 'Language',
                    settings_language_desc: 'Choose your preferred language',
                    settings_name: 'Name',
                    settings_name_desc: 'Personalize your greeting',
                    settings_name_placeholder: 'Your name',
                    settings_timeformat: 'Time Format',
                    settings_timeformat_desc:
                        'Choose between 12h and 24h format',
                    timeformat_12h: '12 Hours',
                    timeformat_24h: '24 Hours',
                    reset_settings: 'Reset to Defaults',

                    // Onboarding
                    onboarding_title: 'welcome to lux',
                    onboarding_subtitle:
                        'Your personalized start page for productive work',
                    onboarding_feature1_title: 'Shortcuts',
                    onboarding_feature1_desc: 'Favorite sites always at hand',
                    onboarding_feature2_title: 'Weather',
                    onboarding_feature2_desc: 'Live weather and forecast',
                    onboarding_feature3_title: 'Personalization',
                    onboarding_feature3_desc: 'Customize theme and language',
                    onboarding_next_btn: 'Next ‚Üí',
                    onboarding_settings_title: 'Settings',
                    onboarding_settings_subtitle: 'Customize Lux to your needs',
                    onboarding_name_label: 'Your Name',
                    onboarding_name_desc: 'How should we greet you?',
                    onboarding_name_placeholder: 'e.g. John',
                    onboarding_timeformat_label: 'Time Format',
                    onboarding_timeformat_desc: 'Choose your preferred format',
                    onboarding_back_btn: '‚Üê Back',
                    onboarding_finish_btn: "Let's go! üöÄ",

                    // Weather
                    weather_location_default: 'Your Location',
                    weather_now: 'Now',
                    weather_today: 'Today',
                    weather_days_short: [
                        'Sun',
                        'Mon',
                        'Tue',
                        'Wed',
                        'Thu',
                        'Fri',
                        'Sat',
                    ],
                },
                es: {
                    // Greetings
                    greeting_morning: 'buenos <em>d√≠as</em>',
                    greeting_afternoon: 'buenas <em>tardes</em>',
                    greeting_evening: 'buenas <em>tardes</em>',
                    greeting_night: 'buenas <em>noches</em>',

                    // Search
                    search_placeholder: 'Ingrese t√©rmino de b√∫squeda o URL',
                    search_aria_label: 'Enviar',

                    // Modal - Add Shortcut
                    modal_title: 'Nuevo Atajo',
                    modal_name_placeholder: 'Nombre (ej. Reddit)',
                    modal_url_placeholder: 'URL (ej. reddit.com)',
                    modal_cancel: 'Cancelar',
                    modal_save: 'Guardar',

                    // Settings Modal
                    settings_title: 'Configuraci√≥n',
                    settings_theme: 'Tema',
                    settings_theme_desc: 'Alternar entre modo claro y oscuro',
                    settings_language: 'Idioma',
                    settings_language_desc: 'Elige tu idioma preferido',
                    settings_name: 'Nombre',
                    settings_name_desc: 'Personaliza tu saludo',
                    settings_name_placeholder: 'Tu nombre',
                    settings_timeformat: 'Formato de Hora',
                    settings_timeformat_desc: 'Elige entre formato 12h y 24h',
                    timeformat_12h: '12 Horas',
                    timeformat_24h: '24 Horas',
                    reset_settings: 'Restablecer',

                    // Onboarding
                    onboarding_title: 'bienvenido a lux',
                    onboarding_subtitle:
                        'Tu p√°gina de inicio personalizada para trabajar productivamente',
                    onboarding_feature1_title: 'Atajos',
                    onboarding_feature1_desc: 'Sitios favoritos siempre a mano',
                    onboarding_feature2_title: 'Clima',
                    onboarding_feature2_desc: 'Clima en vivo y pron√≥stico',
                    onboarding_feature3_title: 'Personalizaci√≥n',
                    onboarding_feature3_desc: 'Personaliza tema e idioma',
                    onboarding_next_btn: 'Siguiente ‚Üí',
                    onboarding_settings_title: 'Configuraci√≥n',
                    onboarding_settings_subtitle:
                        'Personaliza Lux a tus necesidades',
                    onboarding_name_label: 'Tu Nombre',
                    onboarding_name_desc: '¬øC√≥mo deber√≠amos saludarte?',
                    onboarding_name_placeholder: 'ej. Juan',
                    onboarding_timeformat_label: 'Formato de Hora',
                    onboarding_timeformat_desc: 'Elige tu formato preferido',
                    onboarding_back_btn: '‚Üê Atr√°s',
                    onboarding_finish_btn: '¬°Empecemos! üöÄ',

                    // Weather
                    weather_location_default: 'Tu Ubicaci√≥n',
                    weather_now: 'Ahora',
                    weather_today: 'Hoy',
                    weather_days_short: [
                        'Dom',
                        'Lun',
                        'Mar',
                        'Mi√©',
                        'Jue',
                        'Vie',
                        'S√°b',
                    ],
                },
                // Add more languages here
            };

            let currentLanguage = localStorage.getItem('language') || 'de';

            function t(key) {
                return (
                    translations[currentLanguage][key] ||
                    translations['de'][key] ||
                    key
                );
            }

            function changeLanguage(lang) {
                if (!translations[lang]) {
                    console.error(`Language ${lang} not found`);
                    return;
                }

                currentLanguage = lang;
                localStorage.setItem('language', lang);
                updateAllText();
                updateGreeting();
            }

            function updateAllText() {
                // Update search placeholder
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.placeholder = t('search_placeholder');
                }

                // Update modal texts
                const elements = {
                    'modal-title': 'modal_title',
                    'shortcut-name': {
                        attr: 'placeholder',
                        key: 'modal_name_placeholder',
                    },
                    'shortcut-url': {
                        attr: 'placeholder',
                        key: 'modal_url_placeholder',
                    },
                    'modal-cancel': 'modal_cancel',
                    'modal-save': 'modal_save',
                    'settings-title': 'settings_title',
                    'settings-theme-title': 'settings_theme',
                    'settings-theme-desc': 'settings_theme_desc',
                    'settings-language-title': 'settings_language',
                    'settings-language-desc': 'settings_language_desc',
                    'settings-name-title': 'settings_name',
                    'settings-name-desc': 'settings_name_desc',
                    'user-name-input': {
                        attr: 'placeholder',
                        key: 'settings_name_placeholder',
                    },
                    'settings-timeformat-title': 'settings_timeformat',
                    'settings-timeformat-desc': 'settings_timeformat_desc',
                    'timeformat-24h-option': 'timeformat_24h',
                    'timeformat-12h-option': 'timeformat_12h',
                    'reset-settings-text': 'reset_settings',
                    'onboarding-title': 'onboarding_title',
                    'onboarding-subtitle': 'onboarding_subtitle',
                    'onboarding-feature1-title': 'onboarding_feature1_title',
                    'onboarding-feature1-desc': 'onboarding_feature1_desc',
                    'onboarding-feature2-title': 'onboarding_feature2_title',
                    'onboarding-feature2-desc': 'onboarding_feature2_desc',
                    'onboarding-feature3-title': 'onboarding_feature3_title',
                    'onboarding-feature3-desc': 'onboarding_feature3_desc',
                    'onboarding-next-btn': 'onboarding_next_btn',
                    'onboarding-settings-title': 'onboarding_settings_title',
                    'onboarding-settings-subtitle':
                        'onboarding_settings_subtitle',
                    'onboarding-name-label': 'onboarding_name_label',
                    'onboarding-name-desc': 'onboarding_name_desc',
                    'onboarding-name-input': {
                        attr: 'placeholder',
                        key: 'onboarding_name_placeholder',
                    },
                    'onboarding-timeformat-label':
                        'onboarding_timeformat_label',
                    'onboarding-timeformat-desc': 'onboarding_timeformat_desc',
                    'onboarding-back-btn': 'onboarding_back_btn',
                    'onboarding-finish-btn': 'onboarding_finish_btn',
                };

                for (const [id, config] of Object.entries(elements)) {
                    const element = document.getElementById(id);
                    if (element) {
                        if (typeof config === 'string') {
                            element.textContent = t(config);
                        } else {
                            element[config.attr] = t(config.key);
                        }
                    }
                }

                // Update language selector
                updateLanguageSelector();
                updateTimeFormatSelector();
            }

            function updateLanguageSelector() {
                const selector = document.getElementById('language-selector');
                if (selector) {
                    selector.value = currentLanguage;
                }
            }

            function changeTimeFormat(format) {
                localStorage.setItem('timeFormat', format);
                // Wenn das Wetter-Modal offen ist, aktualisiere es
                if (
                    weatherData &&
                    !document
                        .getElementById('weather-modal')
                        .classList.contains('hidden')
                ) {
                    openWeatherModal();
                }
            }

            function updateTimeFormatSelector() {
                const selector = document.getElementById('timeformat-selector');
                if (selector) {
                    const savedFormat =
                        localStorage.getItem('timeFormat') || '24';
                    selector.value = savedFormat;
                }
            }

            function formatHour(hour) {
                const timeFormat = localStorage.getItem('timeFormat') || '24';
                if (timeFormat === '12') {
                    const period = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour % 12 || 12;
                    return `${displayHour} ${period}`;
                }
                return `${hour}:00`;
            }

            function getGreeting() {
                const hour = new Date().getHours();
                const userName = localStorage.getItem('userName') || 'user';
                let greetingText = '';

                if (hour < 12) greetingText = t('greeting_morning');
                else if (hour < 18) greetingText = t('greeting_afternoon');
                else if (hour < 22) greetingText = t('greeting_evening');
                else greetingText = t('greeting_night');
                return `${greetingText}, ${userName}`;
            }

            function updateGreeting() {
                const greeting = document.getElementById('greeting');
                if (greeting) {
                    greeting.innerHTML = getGreeting();
                }
            }

            function updateUserName() {
                const nameInput = document.getElementById('user-name-input');
                if (nameInput && nameInput.value.trim()) {
                    localStorage.setItem('userName', nameInput.value.trim());
                    updateGreeting();
                }
            }

            function loadUserName() {
                const nameInput = document.getElementById('user-name-input');
                if (nameInput) {
                    nameInput.value = localStorage.getItem('userName') || '';
                }
            }

            // Initialize language on page load
            document.addEventListener('DOMContentLoaded', () => {
                updateAllText();
                updateGreeting();
                loadUserName();
                checkOnboarding();
            });

            // --- ONBOARDING ---
            let currentOnboardingStep = 1;

            function checkOnboarding() {
                // Check if user has visited before
                const hasVisited = localStorage.getItem('hasVisited');

                if (!hasVisited) {
                    // First visit - show onboarding
                    showOnboarding();
                }
            }

            function showOnboarding() {
                const modal = document.getElementById('onboarding-modal');
                currentOnboardingStep = 1;
                showOnboardingStep(1);
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                // Update language selector
                updateOnboardingLanguageSelector();
            }

            function showOnboardingStep(step) {
                // Hide all steps
                document
                    .getElementById('onboarding-step-1')
                    .classList.add('hidden');
                document
                    .getElementById('onboarding-step-2')
                    .classList.add('hidden');

                // Show current step
                document
                    .getElementById(`onboarding-step-${step}`)
                    .classList.remove('hidden');
                currentOnboardingStep = step;

                // Load saved values in step 2
                if (step === 2) {
                    const nameInput = document.getElementById(
                        'onboarding-name-input'
                    );
                    const timeFormatSelector = document.getElementById(
                        'onboarding-timeformat-selector'
                    );

                    if (nameInput) {
                        nameInput.value =
                            localStorage.getItem('userName') || '';
                    }
                    if (timeFormatSelector) {
                        timeFormatSelector.value =
                            localStorage.getItem('timeFormat') || '24';
                    }
                }
            }

            function nextOnboardingStep() {
                if (currentOnboardingStep < 2) {
                    showOnboardingStep(currentOnboardingStep + 1);
                }
            }

            function previousOnboardingStep() {
                if (currentOnboardingStep > 1) {
                    showOnboardingStep(currentOnboardingStep - 1);
                }
            }

            function finishOnboarding() {
                // Save settings from step 2
                const nameInput = document.getElementById(
                    'onboarding-name-input'
                );
                const timeFormatSelector = document.getElementById(
                    'onboarding-timeformat-selector'
                );

                if (nameInput && nameInput.value.trim()) {
                    localStorage.setItem('userName', nameInput.value.trim());
                }
                if (timeFormatSelector) {
                    localStorage.setItem(
                        'timeFormat',
                        timeFormatSelector.value
                    );
                }

                // Close onboarding
                closeOnboarding();

                // Update greeting with new name
                updateGreeting();

                // Start weather updates now that onboarding is complete
                updateWeather();
                setInterval(updateWeather, 600000);
            }

            function closeOnboarding() {
                const modal = document.getElementById('onboarding-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');

                // Mark as visited
                localStorage.setItem('hasVisited', 'true');
            }

            function updateOnboardingLanguageSelector() {
                const selector1 = document.getElementById(
                    'onboarding-language-selector'
                );
                const selector2 = document.getElementById(
                    'onboarding-language-selector-step2'
                );
                if (selector1) {
                    selector1.value = currentLanguage;
                }
                if (selector2) {
                    selector2.value = currentLanguage;
                }
            }

            // --- THEME LOGIK ---
            function initTheme() {
                // Pr√ºfen ob 'dark' im localStorage gespeichert ist oder ob das System dark mode bevorzugt
                const savedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia(
                    '(prefers-color-scheme: dark)'
                ).matches;

                if (
                    savedTheme === 'dark' ||
                    (!savedTheme && systemPrefersDark)
                ) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-icon').textContent =
                        'light_mode';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-icon').textContent =
                        'dark_mode';
                }
            }

            function toggleTheme() {
                const html = document.documentElement;
                const icon = document.getElementById('theme-icon');

                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    icon.textContent = 'dark_mode';
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    icon.textContent = 'light_mode';
                }
            }

            // Init Theme immediately
            initTheme();

            // --- WEATHER ---
            let weatherData = null;

            async function getLocation() {
                // Check if we have cached location (valid for 24 hours)
                const cached = localStorage.getItem('weatherLocation');
                if (cached) {
                    const { latitude, longitude, timestamp } =
                        JSON.parse(cached);
                    const age = Date.now() - timestamp;
                    // If less than 24 hours old, use cached location
                    if (age < 24 * 60 * 60 * 1000) {
                        return { latitude, longitude };
                    }
                }

                // Get fresh location
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            resolve,
                            reject
                        );
                    });
                    const { latitude, longitude } = position.coords;

                    // Cache location
                    localStorage.setItem(
                        'weatherLocation',
                        JSON.stringify({
                            latitude,
                            longitude,
                            timestamp: Date.now(),
                        })
                    );

                    return { latitude, longitude };
                } catch (error) {
                    // If permission denied and we have old cache, use it anyway
                    if (cached) {
                        const { latitude, longitude } = JSON.parse(cached);
                        return { latitude, longitude };
                    }
                    throw error;
                }
            }

            async function updateWeather() {
                try {
                    const { latitude, longitude } = await getLocation();

                    // Fetch weather from Open-Meteo (free, no API key needed)
                    const response = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto&forecast_days=7`
                    );
                    const data = await response.json();

                    // Get location name via BigDataCloud (CORS-friendly)
                    let locationName = t('weather_location_default');
                    try {
                        const langMap = { de: 'de', en: 'en', es: 'es' };
                        const langCode = langMap[currentLanguage] || 'en';
                        const geoResponse = await fetch(
                            `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=${langCode}`
                        );
                        const geoData = await geoResponse.json();
                        locationName =
                            geoData.city ||
                            geoData.locality ||
                            geoData.principalSubdivision ||
                            t('weather_location_default');
                    } catch (geoError) {
                        console.warn(
                            'Geocoding failed, using default location name'
                        );
                    }

                    weatherData = {
                        ...data,
                        location: locationName,
                        latitude,
                        longitude,
                    };

                    const temp = Math.round(data.current.temperature_2m);
                    const weatherCode = data.current.weather_code;

                    // Weather code to emoji mapping (WMO codes)
                    const weatherIcons = {
                        0: '‚òÄÔ∏è', // Clear sky
                        1: 'üå§Ô∏è', // Mainly clear
                        2: '‚õÖ', // Partly cloudy
                        3: '‚òÅÔ∏è', // Overcast
                        45: 'üå´Ô∏è', // Fog
                        48: 'üå´Ô∏è', // Depositing rime fog
                        51: 'üå¶Ô∏è', // Drizzle light
                        53: 'üå¶Ô∏è', // Drizzle moderate
                        55: 'üå¶Ô∏è', // Drizzle dense
                        61: 'üåßÔ∏è', // Rain slight
                        63: 'üåßÔ∏è', // Rain moderate
                        65: 'üåßÔ∏è', // Rain heavy
                        71: 'üå®Ô∏è', // Snow slight
                        73: 'üå®Ô∏è', // Snow moderate
                        75: 'üå®Ô∏è', // Snow heavy
                        77: 'üå®Ô∏è', // Snow grains
                        80: 'üå¶Ô∏è', // Rain showers slight
                        81: 'üå¶Ô∏è', // Rain showers moderate
                        82: 'üåßÔ∏è', // Rain showers violent
                        85: 'üå®Ô∏è', // Snow showers slight
                        86: 'üå®Ô∏è', // Snow showers heavy
                        95: '‚õàÔ∏è', // Thunderstorm
                        96: '‚õàÔ∏è', // Thunderstorm with hail
                        99: '‚õàÔ∏è', // Thunderstorm with heavy hail
                    };

                    const icon = weatherIcons[weatherCode] || 'üå§Ô∏è';

                    document.getElementById('weather-icon').textContent = icon;
                    document.getElementById(
                        'weather-temp'
                    ).textContent = `${temp}¬∞`;
                } catch (error) {
                    console.error('Weather fetch failed:', error);
                    document.getElementById('weather-temp').textContent = '--¬∞';
                }
            }

            function getWeatherIcon(code) {
                const icons = {
                    0: '‚òÄÔ∏è',
                    1: 'üå§Ô∏è',
                    2: '‚õÖ',
                    3: '‚òÅÔ∏è',
                    45: 'üå´Ô∏è',
                    48: 'üå´Ô∏è',
                    51: 'üå¶Ô∏è',
                    53: 'üå¶Ô∏è',
                    55: 'üå¶Ô∏è',
                    61: 'üåßÔ∏è',
                    63: 'üåßÔ∏è',
                    65: 'üåßÔ∏è',
                    71: 'üå®Ô∏è',
                    73: 'üå®Ô∏è',
                    75: 'üå®Ô∏è',
                    77: 'üå®Ô∏è',
                    80: 'üå¶Ô∏è',
                    81: 'üå¶Ô∏è',
                    82: 'üåßÔ∏è',
                    85: 'üå®Ô∏è',
                    86: 'üå®Ô∏è',
                    95: '‚õàÔ∏è',
                    96: '‚õàÔ∏è',
                    99: '‚õàÔ∏è',
                };
                return icons[code] || 'üå§Ô∏è';
            }

            function openWeatherModal() {
                if (!weatherData) return;

                const modal = document.getElementById('weather-modal');

                // Set location
                document.getElementById('weather-location').textContent =
                    weatherData.location;

                // Current weather
                const currentTemp = Math.round(
                    weatherData.current.temperature_2m
                );
                const currentCode = weatherData.current.weather_code;
                document.getElementById('weather-current-temp').textContent =
                    currentTemp;
                document.getElementById('weather-current-icon').textContent =
                    getWeatherIcon(currentCode);

                // High/Low for today
                document.getElementById('weather-high').textContent =
                    Math.round(weatherData.daily.temperature_2m_max[0]);
                document.getElementById('weather-low').textContent = Math.round(
                    weatherData.daily.temperature_2m_min[0]
                );

                // Hourly forecast (next 12 hours)
                const hourlyContainer =
                    document.getElementById('hourly-forecast');
                const now = new Date();
                const currentHour = now.getHours();
                hourlyContainer.innerHTML = '';

                for (let i = 0; i < 12; i++) {
                    const hourIndex = currentHour + i;
                    if (hourIndex >= 24) break;

                    const temp = Math.round(
                        weatherData.hourly.temperature_2m[hourIndex]
                    );
                    const code = weatherData.hourly.weather_code[hourIndex];
                    const icon = getWeatherIcon(code);
                    const time =
                        i === 0 ? t('weather_now') : formatHour(hourIndex);

                    const hourItem = document.createElement('div');
                    hourItem.className =
                        'flex flex-col items-center gap-2 min-w-[60px]';
                    hourItem.innerHTML = `
                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">${time}</span>
                        <span class="text-2xl">${icon}</span>
                        <span class="text-sm font-medium">${temp}¬∞</span>
                    `;
                    hourlyContainer.appendChild(hourItem);
                }

                // Daily forecast (7 days) - vertical list
                const dailyContainer =
                    document.getElementById('daily-forecast');
                dailyContainer.innerHTML = '';
                const weekdays = t('weather_days_short');

                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    const dayName =
                        i === 0 ? t('weather_today') : weekdays[date.getDay()];

                    const maxTemp = Math.round(
                        weatherData.daily.temperature_2m_max[i]
                    );
                    const minTemp = Math.round(
                        weatherData.daily.temperature_2m_min[i]
                    );
                    const code = weatherData.daily.weather_code[i];
                    const icon = getWeatherIcon(code);

                    const dayItem = document.createElement('div');
                    dayItem.className =
                        'flex items-center justify-between py-2';
                    dayItem.innerHTML = `
                        <span class="text-base font-medium text-slate-800 dark:text-slate-200 w-16">${dayName}</span>
                        <span class="text-2xl flex-1 text-center">${icon}</span>
                        <div class="flex items-center gap-3 text-base">
                            <span class="font-medium text-slate-800 dark:text-slate-200">${maxTemp}¬∞</span>
                            <span class="text-slate-500 dark:text-slate-500">${minTemp}¬∞</span>
                        </div>
                    `;
                    dailyContainer.appendChild(dayItem);
                }

                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeWeatherModal() {
                const modal = document.getElementById('weather-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            // Close on outside click
            document
                .getElementById('weather-modal')
                ?.addEventListener('click', (e) => {
                    if (e.target === document.getElementById('weather-modal')) {
                        closeWeatherModal();
                    }
                });

            // --- SETTINGS MODAL ---
            function openSettingsModal() {
                const modal = document.getElementById('settings-modal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeSettingsModal() {
                const modal = document.getElementById('settings-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            function resetToDefaults() {
                if (
                    confirm(
                        currentLanguage === 'de'
                            ? 'Alle Einstellungen zur√ºcksetzen? Die Seite wird neu geladen.'
                            : currentLanguage === 'es'
                            ? '¬øRestablecer todas las configuraciones? La p√°gina se recargar√°.'
                            : 'Reset all settings? The page will reload.'
                    )
                ) {
                    localStorage.clear();
                    location.reload();
                }
            }

            // Close on outside click
            document
                .getElementById('settings-modal')
                ?.addEventListener('click', (e) => {
                    if (
                        e.target === document.getElementById('settings-modal')
                    ) {
                        closeSettingsModal();
                    }
                });

            // Update weather on load (only if user has already completed onboarding) and every 10 minutes
            const hasVisited = localStorage.getItem('hasVisited');
            if (hasVisited) {
                updateWeather();
                setInterval(updateWeather, 600000);
            }

            // --- SEARCH ENHANCEMENT ---
            let searchHistory =
                JSON.parse(localStorage.getItem('searchHistory')) || [];
            let currentSuggestionIndex = -1;
            let suggestions = [];

            function clearSearch() {
                document.getElementById('search-input').value = '';
                document.getElementById('clear-btn').classList.add('hidden');
                hideAutocomplete();
                document.getElementById('search-input').focus();
            }

            function hideAutocomplete() {
                document
                    .getElementById('autocomplete-container')
                    .classList.add('hidden');
                currentSuggestionIndex = -1;
            }

            function showAutocomplete() {
                const container = document.getElementById(
                    'autocomplete-container'
                );
                const input = document.getElementById('search-input');
                // Nur anzeigen wenn Input fokussiert ist UND es Vorschl√§ge gibt
                if (
                    suggestions.length > 0 &&
                    document.activeElement === input
                ) {
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                }
            }

            async function fetchSuggestions(query) {
                if (!query.trim()) {
                    // Show history if no query but input is focused
                    if (searchHistory.length > 0) {
                        suggestions = searchHistory.slice(0, 8).map((item) => ({
                            text: item,
                            isHistory: true,
                        }));
                        renderSuggestions();
                    } else {
                        suggestions = [];
                        hideAutocomplete();
                    }
                    return;
                }

                try {
                    // Using JSONP to bypass CORS (works with file:// protocol)
                    const callbackName = 'googleSuggestCallback_' + Date.now();

                    // Create promise to handle JSONP response
                    const jsonpPromise = new Promise((resolve, reject) => {
                        // Set timeout
                        const timeout = setTimeout(() => {
                            cleanup();
                            reject(new Error('Request timeout'));
                        }, 5000);

                        // Define global callback
                        window[callbackName] = (data) => {
                            clearTimeout(timeout);
                            cleanup();
                            resolve(data);
                        };

                        // Create script element
                        const script = document.createElement('script');
                        script.src = `https://suggestqueries.google.com/complete/search?client=firefox&q=${encodeURIComponent(
                            query
                        )}&jsonp=${callbackName}`;
                        script.onerror = () => {
                            clearTimeout(timeout);
                            cleanup();
                            reject(new Error('Script loading failed'));
                        };

                        // Cleanup function
                        function cleanup() {
                            delete window[callbackName];
                            if (script.parentNode) {
                                script.parentNode.removeChild(script);
                            }
                        }

                        // Add script to page
                        document.head.appendChild(script);
                    });

                    const data = await jsonpPromise;

                    suggestions = data[1].slice(0, 8).map((text) => ({
                        text: text,
                        isHistory: false,
                    }));

                    // Mix in relevant history
                    const relevantHistory = searchHistory
                        .filter((h) =>
                            h.toLowerCase().includes(query.toLowerCase())
                        )
                        .slice(0, 2)
                        .map((text) => ({ text, isHistory: true }));

                    suggestions = [...relevantHistory, ...suggestions].slice(
                        0,
                        8
                    );
                    renderSuggestions();
                } catch (error) {
                    console.error('Failed to fetch suggestions:', error);
                    // Fallback to history only
                    const relevantHistory = searchHistory
                        .filter((h) =>
                            h.toLowerCase().includes(query.toLowerCase())
                        )
                        .slice(0, 8)
                        .map((text) => ({ text, isHistory: true }));

                    suggestions = relevantHistory;
                    if (suggestions.length > 0) {
                        renderSuggestions();
                    } else {
                        hideAutocomplete();
                    }
                }
            }

            function renderSuggestions() {
                const list = document.getElementById('autocomplete-list');

                if (suggestions.length === 0) {
                    hideAutocomplete();
                    return;
                }

                list.innerHTML = suggestions
                    .map(
                        (suggestion, idx) => `
                    <div 
                        class="suggestion-item px-6 py-3 cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors flex items-center gap-3 ${
                            idx === currentSuggestionIndex
                                ? 'bg-black/5 dark:bg-white/5'
                                : ''
                        }"
                        data-index="${idx}"
                        onclick="selectSuggestion(${idx})"
                    >
                        <span class="material-symbols-outlined text-[20px] text-slate-400">
                            ${suggestion.isHistory ? 'history' : 'search'}
                        </span>
                        <span class="text-slate-800 dark:text-slate-200">${
                            suggestion.text
                        }</span>
                        ${
                            suggestion.isHistory
                                ? `
                            <button 
                                onclick="event.stopPropagation(); removeFromHistory('${suggestion.text.replace(
                                    /'/g,
                                    "\\'"
                                )}')"
                                class="ml-auto p-1 hover:bg-black/10 dark:hover:bg-white/10 rounded transition-colors"
                            >
                                <span class="material-symbols-outlined text-[16px] text-slate-400">close</span>
                            </button>
                        `
                                : ''
                        }
                    </div>
                `
                    )
                    .join('');

                showAutocomplete();
            }

            function selectSuggestion(index) {
                if (index >= 0 && index < suggestions.length) {
                    const input = document.getElementById('search-input');
                    input.value = suggestions[index].text;
                    hideAutocomplete();
                    document.getElementById('search-form').submit();
                }
            }

            function removeFromHistory(query) {
                searchHistory = searchHistory.filter((item) => item !== query);
                localStorage.setItem(
                    'searchHistory',
                    JSON.stringify(searchHistory)
                );
                const input = document.getElementById('search-input');
                fetchSuggestions(input.value);
            }

            function addToHistory(query) {
                if (!query.trim()) return;
                // Remove if exists, then add to front
                searchHistory = searchHistory.filter((item) => item !== query);
                searchHistory.unshift(query);
                // Keep only last 50
                searchHistory = searchHistory.slice(0, 50);
                localStorage.setItem(
                    'searchHistory',
                    JSON.stringify(searchHistory)
                );
            }

            // Event listeners
            const searchInput = document.getElementById('search-input');
            const searchForm = document.getElementById('search-form');

            searchInput.addEventListener('input', (e) => {
                const value = e.target.value;
                const clearBtn = document.getElementById('clear-btn');

                if (value) {
                    clearBtn.classList.remove('hidden');
                } else {
                    clearBtn.classList.add('hidden');
                }

                fetchSuggestions(value);
            });

            searchInput.addEventListener('focus', (e) => {
                fetchSuggestions(e.target.value);
            });

            searchInput.addEventListener('blur', (e) => {
                // Verz√∂gerung, damit Klicks auf Vorschl√§ge noch funktionieren
                setTimeout(() => {
                    if (!e.target.matches(':focus')) {
                        hideAutocomplete();
                    }
                }, 200);
            });

            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentSuggestionIndex = Math.min(
                        currentSuggestionIndex + 1,
                        suggestions.length - 1
                    );
                    renderSuggestions();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentSuggestionIndex = Math.max(
                        currentSuggestionIndex - 1,
                        -1
                    );
                    renderSuggestions();
                } else if (e.key === 'Enter' && currentSuggestionIndex >= 0) {
                    e.preventDefault();
                    selectSuggestion(currentSuggestionIndex);
                } else if (e.key === 'Escape') {
                    hideAutocomplete();
                }
            });

            searchForm.addEventListener('submit', (e) => {
                const query = searchInput.value.trim();
                if (query) {
                    addToHistory(query);
                }
            });

            // Close autocomplete when clicking outside
            document.addEventListener('click', (e) => {
                const searchContainer =
                    document.querySelector('.group\\/search');
                if (searchContainer && !searchContainer.contains(e.target)) {
                    hideAutocomplete();
                }
            });

            // Update greeting every minute
            setInterval(updateGreeting, 60000);

            // --- SHORTCUTS LOGIK ---
            const defaultShortcuts = [
                { name: 'YouTube', url: 'https://youtube.com' },
                { name: 'GitHub', url: 'https://github.com' },
                { name: 'Wikipedia', url: 'https://wikipedia.org' },
                { name: 'Amazon', url: 'https://amazon.com' },
            ];

            let shortcuts =
                JSON.parse(localStorage.getItem('luxShortcuts')) ||
                defaultShortcuts;
            let draggedIndex = null;

            function renderShortcuts() {
                const container = document.getElementById(
                    'shortcuts-container'
                );
                container.innerHTML = '';

                // Render existing shortcuts
                shortcuts.forEach((item, idx) => {
                    const domain = new URL(item.url).hostname;
                    const iconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;

                    const a = document.createElement('div');
                    a.className =
                        'group relative flex flex-col items-center gap-2 cursor-grab active:cursor-grabbing';
                    a.draggable = true;
                    a.dataset.index = idx;

                    // Drag events
                    a.addEventListener('dragstart', handleDragStart);
                    a.addEventListener('dragover', handleDragOver);
                    a.addEventListener('drop', handleDrop);
                    a.addEventListener('dragend', handleDragEnd);
                    a.addEventListener('dragleave', handleDragLeave);

                    a.onclick = (e) => {
                        if (!e.target.closest('.delete-btn') && !draggedIndex) {
                            window.location.href = item.url;
                        }
                    };

                    a.innerHTML = `
                    <div class="glass-panel w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-xl bg-white/40 dark:bg-white/5 border border-white/50 dark:border-white/5 shadow-sm hover:scale-105 hover:bg-white/60 dark:hover:bg-white/10 hover:shadow-md hover:border-primary/30 transition-all duration-300 relative">
                        <img src="${iconUrl}" alt="${item.name}" class="w-8 h-8 md:w-10 md:h-10 rounded-md object-contain opacity-80 group-hover:opacity-100 transition-opacity" onerror="this.src='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/svgs/solid/link.svg'">
                        
                        <!-- Delete Button (X) -->
                        <button onclick="deleteShortcut(${idx})" class="delete-btn absolute -top-2 -right-2 bg-red-500/90 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-md hover:bg-red-600 transition-colors z-20">
                            <i class="fa-solid fa-times text-[10px]"></i>
                        </button>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity absolute -bottom-6 whitespace-nowrap font-display font-medium">${item.name}</span>
                `;
                    container.appendChild(a);
                });

                // Render "Add New" Button
                const addBtn = document.createElement('button');
                addBtn.className = 'group flex flex-col items-center gap-2';
                addBtn.onclick = openModal;
                addBtn.innerHTML = `
                <div class="glass-panel w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-xl bg-white/30 dark:bg-white/5 border border-dashed border-slate-400 dark:border-slate-700 shadow-none hover:scale-105 hover:bg-white/50 dark:hover:bg-white/10 hover:border-primary/50 transition-all duration-300">
                    <span class="material-symbols-outlined text-[32px] text-slate-500 dark:text-slate-500 group-hover:text-primary transition-colors">add</span>
                </div>
            `;
                container.appendChild(addBtn);
            }

            function handleDragStart(e) {
                draggedIndex = parseInt(e.currentTarget.dataset.index);
                e.currentTarget.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }

            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                const target = e.currentTarget;
                if (
                    target.dataset.index &&
                    !target.classList.contains('dragging')
                ) {
                    target
                        .querySelector('.glass-panel')
                        ?.classList.add('drag-over');
                }
            }

            function handleDragLeave(e) {
                const target = e.currentTarget;
                target
                    .querySelector('.glass-panel')
                    ?.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();

                const target = e.currentTarget;
                target
                    .querySelector('.glass-panel')
                    ?.classList.remove('drag-over');

                const dropIndex = parseInt(target.dataset.index);

                if (
                    draggedIndex !== null &&
                    dropIndex !== undefined &&
                    draggedIndex !== dropIndex
                ) {
                    // Reorder array
                    const draggedItem = shortcuts[draggedIndex];
                    shortcuts.splice(draggedIndex, 1);
                    shortcuts.splice(dropIndex, 0, draggedItem);

                    // Save and re-render
                    localStorage.setItem(
                        'luxShortcuts',
                        JSON.stringify(shortcuts)
                    );
                    renderShortcuts();
                }
            }

            function handleDragEnd(e) {
                e.currentTarget.classList.remove('dragging');
                document.querySelectorAll('.glass-panel').forEach((el) => {
                    el.classList.remove('drag-over');
                });
                draggedIndex = null;
            }

            function addShortcut() {
                const name = document
                    .getElementById('shortcut-name')
                    .value.trim();
                let url = document.getElementById('shortcut-url').value.trim();

                if (!name || !url) return;
                if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

                shortcuts.push({ name, url });
                localStorage.setItem('luxShortcuts', JSON.stringify(shortcuts));
                renderShortcuts();
                closeModal();

                document.getElementById('shortcut-name').value = '';
                document.getElementById('shortcut-url').value = '';
            }

            function deleteShortcut(idx) {
                shortcuts.splice(idx, 1);
                localStorage.setItem('luxShortcuts', JSON.stringify(shortcuts));
                renderShortcuts();
            }

            // --- MODAL ---
            function openModal() {
                const modal = document.getElementById('add-modal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.getElementById('shortcut-name').focus();
            }

            function closeModal() {
                const modal = document.getElementById('add-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            document
                .getElementById('add-modal')
                .addEventListener('click', (e) => {
                    if (e.target === document.getElementById('add-modal'))
                        closeModal();
                });

            document
                .getElementById('add-modal')
                .addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') addShortcut();
                    if (e.key === 'Escape') closeModal();
                });

            // Init
            renderShortcuts();
        </script>
    </body>
</html>
